<!DOCTYPE HTML>
<html>

<head>
    <title>{% block title %} mgui {% endblock %}</title>
    <link rel='stylesheet'
          href="/static/css/jquery-ui-1.10.1.custom.min.css"
          type='text/css'>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Materials Design, Materials Database, Materials Information, Materials Tools" />
    <meta name="description"
          content="Simple access web front end for pymatgen-db databases." />
    <script type="text/javascript" src="/static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery-ui-1.10.1.custom.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.json2html-3.1-min.js" ></script>
    <script type="text/javascript" src="/static/js/DataTables-1.9.4/media/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/static/js/DataTables-1.9.4/extras/TableTools/media/js/TableTools.min.js"></script>
    <script type="text/javascript" src="/static/js/DataTables-1.9.4/extras/Scroller/media/js/dataTables.scroller.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.spinner.js"></script>
    <script type="text/javascript" src="/static/js/home.js"></script>

    <link rel='stylesheet' href="/static/js/DataTables-1.9.4/extras/TableTools/media/css/TableTools.css" type='text/css'>
    <link rel='stylesheet' href="/static/js/DataTables-1.9.4/media/css/jquery.dataTables.css" type='text/css'>
    <link rel='stylesheet' href="/static/css/home.css" type='text/css'>

    {% block extra_css %}{% endblock extra_css %}
    {% block top_javascript %}{% endblock top_javascript %}
</head>

<body>

<h1>materials genomics ui</h1>
<h2 id="subtitle">Connected to: {{ host }}:{{port}} with {{ ndocs }} docs.</h2>
<div id="search-div">
    <div class="input-div">
        <label for="criteria-input"><span
                class="emph">criteria</span> as formula, task_id,
            chemical system or
            mongo query string</label>
        <input id="criteria-input" type="text" name="criteria"
               class="text-search"
            placeholder='Examples: "Li2O", "1234", "Li-Fe-O", {"pretty_formula": "Li2O"}'/>
    </div>
    <div class="input-div">
        <label for="properties-input"><span
                class="emph">properties</span> as space-separated
            strings</label>
        <input id="properties-input" type="text"
               name="properties" class="text-search"
               placeholder='Example: "task_id energy_per_atom"'/>
    </div>

    <div class="input-div">
        <span class="emph">display format:
        <input type="radio" name="display" value="table" checked>table
        <input type="radio" name="display" value="tree">tree</span>
    </div>
    <div class="input-div">
        <button class ="buttons" id="search-button">Search</button>
        <p id="error_msg"></p>
        <p id="help_msg"></p>
    </div>
</div>

<div style=";margin-top:20px;">

    <div class='divider' style='margin-top:40px;'></div>
    <h2 id="num-results">x results</h2>
    <div id='result-tree'></div>
    <div id='results-table-div'>
    <table id='results-table'>
    </table>
    </div>
</div>

</body>



<script type="text/javascript">

    var transforms = {
        'object':{'tag':'div','class':'package ${show} ${type}','children':[
            {'tag':'div','class':'header','children':[
                {'tag':'div','class':function(obj){
                    if( getValue(obj.value) !== undefined ) return('arrow hide');
                    else return('arrow');
                }},
                {'tag':'span','class':'name','html':'${name}'},
                {'tag':'span','class':'value','html':function(obj) {
                    var value = getValue(obj.value);
                    if( value !== undefined ) return(" : " + value);
                    else return('');
                }},
                {'tag':'span','class':'type','html':'${type}'}
            ]},
            {'tag':'div','class':'children','children':function(obj){return(children(obj.value));}}
        ]}
    };

    function visualize(json) {
        $('#result-tree').html('');
        $('#result-tree').json2html(convert('Results',json,'open'),transforms.object);
        regEvents();
    }

    function getValue(obj) {
        var type = $.type(obj);

        //Determine if this object has children
        switch(type) {
            case 'array':
            case 'object':
                return(undefined);
                break;

            case 'function':
                //none
                return('function');
                break;

            case 'string':
                return("'" + obj + "'");
                break;

            default:
                return(obj);
                break;
        }
    }

    //Transform the children
    function children(obj){
        var type = $.type(obj);

        //Determine if this object has children
        switch(type) {
            case 'array':
            case 'object':
                return($.json2html(obj,transforms.object));
                break;

            default:
                //This must be a litteral
                break;
        }
    }

    function convert(name,obj,show) {

        var type = $.type(obj);

        if(show === undefined) show = 'closed';

        var children = [];

        //Determine the type of this object
        switch(type) {
            case 'array':
                //Transform array
                //Itterrate through the array and add it to the elements array
                var len=obj.length;
                for(var j=0;j<len;++j){
                    //Concat the return elements from this objects tranformation
                    children[j] = convert(j,obj[j]);
                }
                break;

            case 'object':
                //Transform Object
                var j = 0;
                for(var prop in obj) {
                    children[j] = convert(prop,obj[prop]);
                    j++;
                }
                break;

            default:
                //This must be a litteral (or function)
                children = obj;
                break;
        }

        return( {'name':name,'value':children,'type':type,'show':show} );

    }

    function regEvents() {

        $('.header').click(function(){
            var parent = $(this).parent();

            if(parent.hasClass('closed')) {
                parent.removeClass('closed');
                parent.addClass('open');
            } else {
                parent.removeClass('open');
                parent.addClass('closed');
            }
        });
    }

</script>

</html>
